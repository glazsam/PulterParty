<!DOCTYPE html>
<html>
<head profile="http://www.w3.org/2005/10/profile">
    <link rel="icon" type="image/ico" href="img/favicon.ico" />
    <meta charset="UTF-8">
    <title>Pulter Party Day</title>
    <style>
        #timer {
            margin: 20px auto;
            color: #39bdcc;
            font-family: Impact, Charcoal, sans-serif;
            font-size: 100px;
            cursor: default;
            width: 800px;
        }

        #title {
            margin: 20px auto;
            font-family: Impact, Charcoal, sans-serif;
            cursor: default;
            width: 100%;
            color: #455866;
            font-size:50px;
            text-align: center;
        }

        #sound {
            color: #39bdcc;
            font-family: Impact, Charcoal, sans-serif;
            font-size: 30px;
            text-align: center;
        }

        .celebration {
            color: #39bdcc;
            font-family: Impact, Charcoal, sans-serif;
            font-size: 30px;
            text-align: center;
        }

        .no-display{
            display: none;
        }

        #timer div {
            display: inline-block;
        }

        #timer div div{
            min-width: 105px;
            width:105px;
        }

            #timer div div:not(.type_value){
                text-align:right;
            }

            #timer #millisecond {
                color: #455866;
                font-size: 75px;
            }

        .header{
            width: 100%;
            height: 30px;
            background-image: url('img/42e88e6d6debf95b215ab55d8dd2f17c.gif');
        }

        #timer div div.type_value{
            color: #455866;
            position:absolute;
            font-size: 15px;
        }


        .default-button {
            border: 2px solid #39bdcc;
            color: #39bdcc;
            font: 18px/10px Impact, Charcoal, sans-serif;
            height: 34px;
            padding: 10px 25px;
            vertical-align: middle;
            background: none;
            position: relative;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }

            .default-button:hover {
                color: #fff;
                background: #39bdcc;
                border: 2px solid #39bdcc;
            }

        .checkbox {
            position: absolute;
            z-index: -1;
            opacity: 0;
            margin: 10px 0 0 20px;
        }

            .checkbox + label {
                position: relative;
                padding: 0 0 0 60px;
                cursor: pointer;
            }

                .checkbox + label:before {
                    content: '';
                    position: absolute;
                    top: 6px;
                    left: 0;
                    width: 50px;
                    height: 26px;
                    border-radius: 13px;
                    background: #455866;
                    transition: .2s;
                }

                .checkbox + label:after {
                    content: '';
                    position: absolute;
                    top: 8px;
                    left: 2px;
                    width: 22px;
                    height: 22px;
                    border-radius: 10px;
                    background: #FFF;
                    transition: .2s;
                }

            .checkbox:checked + label:before {
                background: #39bdcc;
            }

            .checkbox:checked + label:after {
                left: 26px;
            }

        input, label {
            display: inline-block;
            vertical-align: baseline;
        }

        .cat-dance {
            width: 100%;
            position: relative;
        }

        .first-cat {
            position: absolute;
            left: 120px;
            top: -330px;
        }

        .second-cat {
            position: absolute;
            right: 120px;
            top: -330px;
        }

    </style>
    
</head>
<body>
    <div class="header">

    </div>
    <div class="main">
        <div>
            <audio id="music" loop>
                <source src="tetris.mp3" type="audio/mpeg">
            </audio>
        </div>
        <h1 id="title">
            До корпоратива осталось
        </h1>
        <div id="timer">
            <div>
                <div class="day type_value">
                </div>
                <div id="day"></div>
            </div>&nbsp;:
            <div>
                <div class="hour type_value">
                </div>
                <div id="hour"></div>
            </div>&nbsp;:
            <div>
                <div class="minute type_value">
                </div>
                <div id="minute"></div>
            </div>&nbsp;:
            <div>
                <div class="second type_value">
                </div>
                <div id="second"></div>
            </div>&nbsp;.
            <div>
                <div class="millisecond type_value">
                    миллисекунды
                </div>
                <div id="millisecond"></div>
            </div>
        </div>

        <div style="text-align:center;">
            <img src="img/mascotte.png" />
        </div>
        <div id="sound">
            <input class="checkbox" type="checkbox" id="mute" name="mute" title="Добавить праздника">
            <label for="mute">Надень наушники и добавить праздника!</label>
        </div>
        <div id="cat" class="celebration no-display">
            <input class="checkbox" type="checkbox" id="cats" name="cats" title="Добавить еще больше праздника праздника!">
            <label for="cats">Добавить еще больше праздника!</label>
        </div>
        
        <div class="cat-dance no-display">
            <img class="first-cat" src="img/1458057342_104.gif" />
            <img class="second-cat" src="img/1458057342_104.gif" />
        </div>

        <div style="text-align:center; position:absolute; left:46%; top:620px;">
            <a href="https://docs.google.com/spreadsheets/d/1mo6qfffZ92H_KkYzQtnpBL9BU9-Fi6CUe3mNRC1VXuk/edit#gid=1524227442" target="_blank" class="default-button">Посмотреть смету</a>
        </div>




    </div>
    
    <script>

        var cssNoDisplayClass = 'no-display';
        var cssCatDanceClass = 'cat-dance';

        var cat = document.getElementById('cat');
        var cats = document.getElementById('cats');
        var catDance = document.getElementsByClassName(cssCatDanceClass);

        var music = document.getElementById("music");
        var mute = document.getElementById("mute");

		mute.addEventListener('change', function() {
		 if(mute.checked) 
		 {
             music.play();
             cat.classList.toggle(cssNoDisplayClass);
		 } 
		 else{
            music.pause();
            music.currentTime = 0;
             cat.classList.toggle(cssNoDisplayClass);
             cats.checked = false;
             catDance[0].classList.add(cssNoDisplayClass);
		 }
		});

        cats.addEventListener('change', function () {
            if (cats.checked) {
                catDance[0].classList.toggle(cssNoDisplayClass);
            }
            else {
                catDance[0].classList.toggle(cssNoDisplayClass);
            }
        });
		
        var timerId;

        var originDate = {
            days: undefined,
            hours: undefined,
            minutes: undefined,
            seconds: undefined
        }

        var htmlElementIdEnum = {
            day: "day",
            hour: "hour",
            minute: "minute",
            second: "second",
            millisecond: "millisecond"
        }

        function getTimeRemaining(endtime) {
            var curDate = Date.parse(new Date());
            var t = Date.parse(endtime) - curDate;
            var milliseconds = 000;
            var seconds = Math.floor((t / 1000) % 60);
            var minutes = Math.floor((t / 1000 / 60) % 60);
            var hours = Math.floor((t / (1000 * 60 * 60)) % 24);
            var days = Math.floor(t / (1000 * 60 * 60 * 24));
            return {
                'total': t,
                'days': days,
                'hours': hours,
                'minutes': minutes,
                'seconds': seconds,
                'milliseconds': milliseconds
            };
        }

        function startTime() {	

            var partyDay = new Date(2018, 11, 14, 15, 0, 0);

            var total = getTimeRemaining(partyDay).total;

            var seconds = getTimeRemaining(partyDay).seconds;
            var minutes = getTimeRemaining(partyDay).minutes;
            var hours = getTimeRemaining(partyDay).hours;
            var days = getTimeRemaining(partyDay).days;
            var milliseconds = getTimeRemaining(partyDay).milliseconds;
            
            ms = checkTime(milliseconds, true);
            s = checkTime(seconds);
            m = checkTime(minutes);
            h = checkTime(hours);
            d = checkTime(days);

            if (!originDate.days) {
                originDate.days = d;
                document.getElementById(htmlElementIdEnum.day).innerHTML = d;
                setNameValue(htmlElementIdEnum.day, d);
            };
            if (!originDate.hours) {
                originDate.hours = h;
                document.getElementById(htmlElementIdEnum.hour).innerHTML = h;
                setNameValue(htmlElementIdEnum.hour, h);
            }
            if (!originDate.minutes) {
                originDate.minutes = m;
                document.getElementById(htmlElementIdEnum.minute).innerHTML = m;
                setNameValue(htmlElementIdEnum.minute, m);

            }
            if (!originDate.seconds) {
                originDate.seconds = s;
                document.getElementById(htmlElementIdEnum.second).innerHTML = s;
                setNameValue(htmlElementIdEnum.second, s);
            }
            if (originDate.days != d) {
                originDate.days = d;
                document.getElementById(htmlElementIdEnum.day).innerHTML = d;
                setNameValue(htmlElementIdEnum.day, d);
            }
            if (originDate.hours != h) {
                originDate.hours = h;
                document.getElementById(htmlElementIdEnum.hour).innerHTML = h;
                setNameValue(htmlElementIdEnum.hour, h);
            }
            if (originDate.minutes != m) {
                originDate.minutes = m;
                document.getElementById(htmlElementIdEnum.minute).innerHTML = m;
                setNameValue(htmlElementIdEnum.minute, m);
            }
            if (originDate.seconds != s) {
                originDate.seconds = s;
                document.getElementById(htmlElementIdEnum.second).innerHTML = s;
                setNameValue(htmlElementIdEnum.second, s);
            }

            document.getElementById(htmlElementIdEnum.millisecond).innerHTML = ms;


            timerId = setTimeout(this.startTime, 1);
        }
        function checkTime(i, is_milliseconds) {
            var rval = i;
            if (i < 10) {
                rval = "0" + rval;
            }
            if (is_milliseconds && i < 100) {
                rval = "0" + rval;
            }
            return rval;
        }

        function getNoun(number, one, two, five) {
            number = Math.abs(number);
            number %= 100;
            if (number >= 5 && number <= 20) {
                return five;
            }
            number %= 10;
            if (number == 1) {
                return one;
            }
            if (number >= 2 && number <= 4) {
                return two;
            }
            return five;
        } 

        function setNameValue(name, value) {
            switch (name) {

                case htmlElementIdEnum.day:
                    document.getElementsByClassName(htmlElementIdEnum.day)[0].innerHTML = getNoun(value, "день", "дня", "дней");
                    break;
                case htmlElementIdEnum.hour:
                    document.getElementsByClassName(htmlElementIdEnum.hour)[0].innerHTML = getNoun(value, "час", "часа", "часов");
                    break;
                case htmlElementIdEnum.minute:
                    document.getElementsByClassName(htmlElementIdEnum.minute)[0].innerHTML = getNoun(value, "минута", "минуты", "минут");
                    break;
                case htmlElementIdEnum.second:
                    document.getElementsByClassName(htmlElementIdEnum.second)[0].innerHTML = getNoun(value, "секунда", "секунды", "секунд");
                    break;
            }

            
        }

        document.addEventListener("DOMContentLoaded", function (event) {
            startTime();
        });
    </script>
</body>
</html>